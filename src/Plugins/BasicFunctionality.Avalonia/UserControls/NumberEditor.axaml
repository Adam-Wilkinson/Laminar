<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:uid="using:Laminar.PluginFramework.UserInterface.UserInterfaceDefinitions"
             xmlns:local="using:BasicFunctionality.Avalonia"
             mc:Ignorable="d" d:DesignWidth="300" d:DesignHeight="40" d:DataContext="{x:Static uid:NumberEntry.DesignInstance}"
             x:DataType="uid:NumberEntry+UITarget"
             x:Class="BasicFunctionality.Avalonia.UserControls.NumberEditor">
	<UserControl.Resources>
      <StreamGeometry x:Key="ButtonSpinnerIncreaseButtonIcon">M0,9 L10,0 20,9 19,10 10,2 1,10 z</StreamGeometry>
      <StreamGeometry x:Key="ButtonSpinnerDecreaseButtonIcon">M0,1 L10,10 20,1 19,0 10,8 1,0 z</StreamGeometry>

      <ControlTheme x:Key="ButtonSpinnerRepeatButton" TargetType="RepeatButton">
        <Setter Property="Template">
          <ControlTemplate>
            <ContentPresenter x:Name="PART_ContentPresenter"
                              Background="{TemplateBinding Background}"
                              BorderBrush="{TemplateBinding BorderBrush}"
                              BorderThickness="{TemplateBinding BorderThickness}"
                              Content="{TemplateBinding Content}"
                              ContentTemplate="{TemplateBinding ContentTemplate}"
                              Padding="{TemplateBinding Padding}"
                              HorizontalContentAlignment="{TemplateBinding HorizontalContentAlignment}"
                              VerticalContentAlignment="{TemplateBinding VerticalContentAlignment}" />
          </ControlTemplate>
        </Setter>
        <Style Selector="^:pointerover /template/ ContentPresenter#PART_ContentPresenter">
          <Setter Property="Background" Value="{DynamicResource RepeatButtonBackgroundPointerOver}" />
        </Style>

        <Style Selector="^:pressed /template/ ContentPresenter#PART_ContentPresenter">
          <Setter Property="Background" Value="{DynamicResource RepeatButtonBackgroundPressed}" />
        </Style>

        <Style Selector="^:disabled /template/ ContentPresenter#PART_ContentPresenter">
          <Setter Property="Background" Value="{DynamicResource RepeatButtonBackgroundDisabled}" />
          <Setter Property="Foreground" Value="{DynamicResource RepeatButtonForegroundDisabled}" />
        </Style>
      </ControlTheme>

      <ControlTheme x:Key="MyButtonSpinner" TargetType="ButtonSpinner">
        <Setter Property="Foreground" Value="{DynamicResource TextControlForeground}" />
        <Setter Property="Padding" Value="0, 0" />
        <Setter Property="Background" Value="{DynamicResource TextControlBackground}" />
        <Setter Property="BorderBrush" Value="{DynamicResource TextControlBorderBrush}" />
        <Setter Property="BorderThickness" Value="{DynamicResource TextControlBorderThemeThickness}" />
        <Setter Property="CornerRadius" Value="{DynamicResource ControlCornerRadius}" />
        <Setter Property="MinHeight" Value="{DynamicResource TextControlThemeMinHeight}" />
        <Setter Property="MinWidth" Value="{DynamicResource TextControlThemeMinWidth}" />
        <Setter Property="HorizontalContentAlignment" Value="Stretch" />
        <Setter Property="VerticalContentAlignment" Value="Center" />
        <Setter Property="Focusable" Value="True"/>
        <Setter Property="Template">
          <ControlTemplate>
            <DataValidationErrors>
              <Border Background="{TemplateBinding Background}"
                      BorderBrush="{TemplateBinding BorderBrush}"
                      BorderThickness="{TemplateBinding BorderThickness}"
                      CornerRadius="{TemplateBinding CornerRadius}"
                      MinHeight="{TemplateBinding MinHeight}">
                <DockPanel>
                  <Grid Name="PART_SpinnerPanel" MinWidth="34"
                              TabIndex="2"
                              DockPanel.Dock="Right"
                              RowDefinitions="*,*"
                              IsVisible="{TemplateBinding ShowButtonSpinner}">
                    <RepeatButton Grid.Row="0" Name="PART_IncreaseButton"
                                  IsTabStop="{TemplateBinding IsTabStop}"
                                  Theme="{StaticResource ButtonSpinnerRepeatButton}"
                                  Background="{TemplateBinding Background}"
                                  VerticalAlignment="Stretch"
                                  VerticalContentAlignment="Center"
                                  Foreground="{TemplateBinding Foreground}">
                      <PathIcon Width="12"
                                Data="{StaticResource ButtonSpinnerIncreaseButtonIcon}" />
                    </RepeatButton>

                    <RepeatButton Grid.Row="1" Name="PART_DecreaseButton"
                                  IsTabStop="{TemplateBinding IsTabStop}"
                                  Theme="{StaticResource ButtonSpinnerRepeatButton}"
                                  Background="{TemplateBinding Background}"
                                  VerticalAlignment="Stretch"
                                  VerticalContentAlignment="Center"
                                  Foreground="{TemplateBinding Foreground}">
                      <PathIcon Width="12"
                                Data="{StaticResource ButtonSpinnerDecreaseButtonIcon}" />
                    </RepeatButton>
                  </Grid>

                  <ContentPresenter Name="PART_ContentPresenter"
                                    TabIndex="1"
                                    ContentTemplate="{TemplateBinding ContentTemplate}"
                                    Content="{TemplateBinding Content}"
                                    HorizontalContentAlignment="{TemplateBinding HorizontalContentAlignment}"
                                    VerticalContentAlignment="{TemplateBinding VerticalContentAlignment}"
                                    Padding="{TemplateBinding Padding}" />
                </DockPanel>
              </Border>
            </DataValidationErrors>
          </ControlTemplate>
        </Setter>
        <Style Selector="^:left">
          <Style Selector="^ /template/ StackPanel#PART_SpinnerPanel">
            <Setter Property="DockPanel.Dock" Value="Left"/>
          </Style>
        </Style>
        <Style Selector="^:error">
          <Setter Property="BorderBrush" Value="{DynamicResource SystemErrorTextColor}" />
        </Style>
      </ControlTheme>
	</UserControl.Resources>
	
	<local:ValueEditorPanel HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Name="MainGrid">
		<TextBlock local:ValueEditorPanel.Position="Nameplate"
               Text="{Binding Name}" 
               VerticalAlignment="Center"/>
		<NumericUpDown local:ValueEditorPanel.Position="Value"  
                   VerticalContentAlignment="Center" 
                   Value="{Binding Value}" 
                   VerticalAlignment="Stretch" HorizontalAlignment="Stretch"
                   MinWidth="0"
                   Margin="5,0,0,0">
      <NumericUpDown.Styles>
        <Style Selector="NumericUpDown /template/ ButtonSpinner#PART_Spinner">
          <Setter Property="Theme" Value="{StaticResource MyButtonSpinner}"/>
        </Style>
      </NumericUpDown.Styles>
    </NumericUpDown>
    
    <local:ValueEditorPanel.Styles>
      <Style Selector="local|ValueEditorPanel[IsCompact=True] > NumericUpDown">
        <Setter Property="ShowButtonSpinner" Value="False"/>
      </Style>
      
      <Style Selector="local|ValueEditorPanel[IsCompact=False] > NumericUpDown">
        <Setter Property="FormatString" Value="{Binding Definition.FormatString}"/>
        <Setter Property="ShowButtonSpinner" Value="True"/>
      </Style>
    </local:ValueEditorPanel.Styles>
	</local:ValueEditorPanel>
</UserControl>
